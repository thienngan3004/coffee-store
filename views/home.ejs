<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coffee Store</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <header>
      <h1>Coffee Store</h1>
      <nav>
        <a href="/">Trang ch·ªß</a>
        <a href="/cart">Gi·ªè h√†ng</a>
        <a href="/checkout">Thanh to√°n</a>
        <a href="/auth/profile">H·ªì s∆°</a>
        <% if (user) { %>
          <span>üëã Xin ch√†o, <%= user.username %>!</span>
          <a href="/auth/logout">ƒêƒÉng xu·∫•t</a>
        <% } else { %>
          <a href="/auth/login">ƒêƒÉng nh·∫≠p</a>
          <a href="/auth/register">ƒêƒÉng k√Ω</a>
        <% } %>
      </nav>
    </header>

    <main>
      <section class="search-filter-container">
        <form action="/" method="GET">
          <input
            type="text"
            name="search"
            placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
            value="<%= typeof search !== 'undefined' ? search : '' %>" />
          <select name="category">
            <option value="">T·∫•t c·∫£ danh m·ª•c</option>
            <% ['coffee', 'tea', 'smoothie', 'juice', 'yogurt', 'water', 'chocolate'].forEach(cat => { %>
              <option value="<%= cat %>" <%= category === cat ? 'selected' : '' %>>
                <%= cat.charAt(0).toUpperCase() + cat.slice(1) %>
              </option>
            <% }) %>
          </select>
          <input
            type="number"
            name="minPrice"
            placeholder="Gi√° t·ªëi thi·ªÉu"
            value="<%= typeof minPrice !== 'undefined' ? minPrice : '' %>" />
          <input
            type="number"
            name="maxPrice"
            placeholder="Gi√° t·ªëi ƒëa"
            value="<%= typeof maxPrice !== 'undefined' ? maxPrice : '' %>" />
          <button type="submit">T√¨m ki·∫øm</button>
        </form>
      </section>

      <h2>Danh s√°ch s·∫£n ph·∫©m</h2>
      <section class="product-grid container">
        <% if (products && products.length > 0) { %>
          <% products.forEach(product => { %>
            <div class="product">
              <img
                src="<%= product.image %>"
                alt="<%= product.name %>"
                width="150"
                class="product-image" />
              <h3 class="product-name"><%= product.name %></h3>
              <% if (product.discount > 0) { %>
                <p class="original-price">
                  Gi√° g·ªëc: <del><%= product.price %> VND</del>
                </p>
                <p class="discount-price">
                  Gi√° gi·∫£m: <%= (product.price * (1 - product.discount / 100)).toFixed(0) %> VND
                </p>
              <% } else { %>
                <p class="price">Gi√°: <%= product.price %> VND</p>
              <% } %>
              <div class="product-buttons">
                <button class="product-button view-details"
                        data-id="<%= product._id %>"
                        data-name="<%= product.name %>"
                        data-price="<%= product.price %>"
                        data-discount="<%= product.discount %>"
                        data-image="<%= product.image %>">
                  Xem chi ti·∫øt
                </button>
                <button class="product-button add-to-cart" data-id="<%= product._id %>">
                  Th√™m v√†o gi·ªè h√†ng
                </button>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>
        <% } %>
      </section>
    </main>

    <!-- MODAL CHI TI·∫æT S·∫¢N PH·∫®M -->
    <div id="product-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <img id="modal-image" src="" alt="Product Image" class="modal-image" />
        <h3 id="modal-name" class="modal-name"></h3>
        <p id="modal-price" class="modal-price"></p>
        <label for="modal-quantity">S·ªë l∆∞·ª£ng:</label>
        <input type="number" id="modal-quantity" value="1" min="1" class="modal-quantity" />
        <div class="modal-buttons">
          <button id="modal-add-to-cart" class="product-button">Th√™m v√†o gi·ªè h√†ng</button>
          <button id="modal-close" class="product-button">ƒê√≥ng</button>
        </div>
      </div>
    </div>

    <script src="/script.js"></script>
  </body>
</html>
